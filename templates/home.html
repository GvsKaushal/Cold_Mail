{% include 'header.html'%}
{% include 'navbar.html'%}

<div class="container mt-5">
    <h1 class="text-center">Cold Mail Generator</h1>
    <form id="generateEmailForm" class="mt-4">
        <div class="mb-3">
            <label for="url" class="form-label">Enter a URL:</label>
            <input
                    type="url"
                    id="url"
                    name="url"
                    class="form-control"
                    placeholder="https://example.com"
                    required
            />
        </div>
        <button type="submit" class="btn btn-outline-primary">
            Generate Email
        </button>
        <div
                class="spinner-border text-primary"
                role="status"
                id="loadingIndicator"
        >
            <span class="visually-hidden">Loading...</span>
        </div>
    </form>
    <div id="results" class="mt-5 mb-5">
        <h3>Generated Emails:</h3>
        <div id="emailsContainer"></div>
    </div>
</div>

<script>
    document
      .getElementById("generateEmailForm")
      .addEventListener("submit", async function (event) {
        event.preventDefault();
        const url = document.getElementById("url").value;
        const resultsContainer = document.getElementById("emailsContainer");
        const loadingIndicator = document.getElementById("loadingIndicator");
        resultsContainer.innerHTML = "";
        loadingIndicator.style.display = "inline-block";

        try {
          const response = await fetch("/generate-email/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ url }),
          });

          if (!response.ok) {
            const error = await response.json();
            resultsContainer.innerHTML = `<div class="alert alert-danger">Error: ${error.detail}</div>`;
            return;
          }

          const data = await response.json();
          if (data.emails.length > 0) {
            data.emails.forEach((item) => {
              const emailHTML = `
                          <div class="card mt-3">
                              <div class="card-body">
                                  <p><strong>Email:</strong></p>
                                  <pre>${item.email}</pre>
                                  <button class="btn btn-outline-dark btn-lg" onclick="copyToClipboard(this)">Copy</button>
                              </div>
                          </div>
                      `;
              resultsContainer.innerHTML += emailHTML;
            });
          } else {
            resultsContainer.innerHTML =
              '<div class="alert alert-warning">No emails generated.</div>';
          }
        } catch (error) {
          resultsContainer.innerHTML = `<div class="alert alert-danger">An unexpected error occurred: ${error.message}</div>`;
        } finally {
          loadingIndicator.style.display = "none";
        }
      });

    function copyToClipboard(button) {
      const text = button.previousElementSibling.innerText.trim();
      navigator.clipboard
        .writeText(text)
        .then(() => {
          const notification = document.createElement("div");
          notification.innerText = "Email copied to clipboard!";
          notification.style.position = "fixed";
          notification.style.top = "30px";
          notification.style.right = "30px";
          notification.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
          notification.style.color = "#fff";
          notification.style.padding = "10px";
          notification.style.borderRadius = "5px";
          notification.style.zIndex = "1000";
          document.body.appendChild(notification);
          setTimeout(() => document.body.removeChild(notification), 5000);
        })
        .catch((err) => {
          const notification = document.createElement("div");
          notification.innerText = "Failed to copy: " + err;
          notification.style.position = "fixed";
          notification.style.top = "30px";
          notification.style.right = "30px";
          notification.style.backgroundColor = "rgba(255, 0, 0, 0.7)";
          notification.style.color = "#fff";
          notification.style.padding = "10px";
          notification.style.borderRadius = "5px";
          notification.style.zIndex = "1000";
          document.body.appendChild(notification);
          setTimeout(() => document.body.removeChild(notification), 5000);
        });
    }
</script>

{% include 'footer.html'%}
